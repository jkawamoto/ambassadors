<!DOCTYPE html>
<html amp lang="en-us">
	<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8" />
  <script async custom-element="amp-ad" src="https://cdn.ampproject.org/v0/amp-ad-0.1.js"></script>
  <script async custom-element="amp-analytics"
      src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
  <script async src="https://cdn.ampproject.org/v0.js"></script>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0" />
  <meta name="description" content="Yet another Ambassador pattern over SSH">
  <link rel="canonical" type="text/html" href="https://jkawamoto.github.io/ambassadors/" />
  <link rel="alternate" type="application/rss" href="https://jkawamoto.github.io/ambassadors/index.xml" />
  
  <meta name="generator" content="Hugo 0.30" />

  <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style>
  <noscript>
    <style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style>
  </noscript>

  <title>AmbassadorS</title>

  <style amp-custom>div.clearer{clear:both}div.related{width:100%;font-size:90%}div.related h3{display:none}div.related ul{margin:0;padding:0 0 0 10px;list-style:none}div.related li{display:inline}div.related li.right{float:right;margin-right:5px}div.sphinxsidebarwrapper{padding:10px 5px 0 10px}div.sphinxsidebar{float:left;width:230px;margin-left:-100%;font-size:90%}div.sphinxsidebar ul{list-style:none}div.sphinxsidebar ul ul,div.sphinxsidebar ul.want-points{margin-left:20px;list-style:square}div.sphinxsidebar ul ul{margin-top:0;margin-bottom:0}div.sphinxsidebar form{margin-top:10px}div.sphinxsidebar input{border:1px solid #98dbcc;font-family:sans-serif;font-size:1em}div.sphinxsidebar #searchbox input[type="text"]{width:170px}div.sphinxsidebar #searchbox input[type="submit"]{width:30px}img{border:0;max-width:100%}ul.search{margin:10px 0 0 20px;padding:0}ul.search li{padding:5px 0 5px 20px;background-image:url(file.png);background-repeat:no-repeat;background-position:0 7px}ul.search li a{font-weight:bold}ul.search li div.context{color:#888;margin:2px 0 0 30px;text-align:left}ul.keywordmatches li.goodmatch a{font-weight:bold}table.contentstable{width:90%}table.contentstable p.biglink{line-height:150%}a.biglink{font-size:1.3em}span.linkdescr{font-style:italic;padding-top:5px;font-size:90%}table.indextable{width:100%}table.indextable td{text-align:left;vertical-align:top}table.indextable dl,table.indextable dd{margin-top:0;margin-bottom:0}table.indextable tr.pcap{height:10px}table.indextable tr.cap{margin-top:10px;background-color:#f2f2f2}img.toggler{margin-right:3px;margin-top:3px;cursor:pointer}div.modindex-jumpbox{border-top:1px solid #ddd;border-bottom:1px solid #ddd;margin:1em 0 1em 0;padding:.4em}div.genindex-jumpbox{border-top:1px solid #ddd;border-bottom:1px solid #ddd;margin:1em 0 1em 0;padding:.4em}a.headerlink{visibility:hidden}h1:hover>a.headerlink,h2:hover>a.headerlink,h3:hover>a.headerlink,h4:hover>a.headerlink,h5:hover>a.headerlink,h6:hover>a.headerlink,dt:hover>a.headerlink,caption:hover>a.headerlink,p.caption:hover>a.headerlink,div.code-block-caption:hover>a.headerlink{visibility:visible}div.body p.caption{text-align:inherit}div.body td{text-align:left}.field-list ul{padding-left:1em}.first{margin-top:0}p.rubric{margin-top:30px;font-weight:bold}img.align-left,.figure.align-left,object.align-left{clear:left;float:left;margin-right:1em}img.align-right,.figure.align-right,object.align-right{clear:right;float:right;margin-left:1em}img.align-center,.figure.align-center,object.align-center{display:block;margin-left:auto;margin-right:auto}.align-left{text-align:left}.align-center{text-align:center}.align-right{text-align:right}div.sidebar{margin:0 0 .5em 1em;border:1px solid #ddb;padding:7px 7px 0 7px;background-color:#ffe;width:40%;float:right}p.sidebar-title{font-weight:bold}div.topic{border:1px solid #ccc;padding:7px 7px 0 7px;margin:10px 0 10px 0}p.topic-title{font-size:1.1em;font-weight:bold;margin-top:10px}div.admonition{margin-top:10px;margin-bottom:10px;padding:7px}div.admonition dt{font-weight:bold}div.admonition dl{margin-bottom:0}p.admonition-title{margin:0 10px 5px 0;font-weight:bold}div.body p.centered{text-align:center;margin-top:25px}table.docutils{border:0;border-collapse:collapse}table caption span.caption-number{font-style:italic}table.docutils td,table.docutils th{padding:1px 8px 1px 5px;border-top:0;border-left:0;border-right:0;border-bottom:1px solid #aaa}table.field-list td,table.field-list th{border:0}table.footnote td,table.footnote th{border:0}th{text-align:left;padding-right:5px}table.citation{border-left:solid 1px gray;margin-left:1px}table.citation td{border-bottom:0}div.figure{margin:.5em;padding:.5em}div.figure p.caption{padding:.3em}div.figure p.caption span.caption-number{font-style:italic}ol.arabic{list-style:decimal}ol.loweralpha{list-style:lower-alpha}ol.upperalpha{list-style:upper-alpha}ol.lowerroman{list-style:lower-roman}ol.upperroman{list-style:upper-roman}dl{margin-bottom:15px}dd p{margin-top:0}dd ul,dd table{margin-bottom:10px}dd{margin-top:3px;margin-bottom:10px;margin-left:30px}dt:target,.highlighted{background-color:#fbe54e}dl.glossary dt{font-weight:bold;font-size:1.1em}.field-list ul{margin:0;padding-left:1em}.field-list p{margin:0}.optional{font-size:1.3em}.sig-paren{font-size:larger}.versionmodified{font-style:italic}.system-message{background-color:#fda;padding:5px;border:3px solid red}.footnote:target{background-color:#ffa}.line-block{display:block;margin-top:1em;margin-bottom:1em}.line-block .line-block{margin-top:0;margin-bottom:0;margin-left:1.5em}.guilabel,.menuselection{font-family:sans-serif}.accelerator{text-decoration:underline}.classifier{font-style:oblique}abbr,acronym{border-bottom:dotted 1px;cursor:help}pre{overflow:auto;overflow-y:hidden}td.linenos pre{padding:5px 0;border:0;background-color:transparent;color:#aaa}table.highlighttable{margin-left:.5em}table.highlighttable td{padding:0 .5em 0 .5em}div.code-block-caption{padding:2px 5px;font-size:small}div.code-block-caption code{background-color:transparent}div.code-block-caption+div>div.highlight>pre{margin-top:0}div.code-block-caption span.caption-number{padding:.1em .3em;font-style:italic}div.literal-block-wrapper{padding:1em 1em 0}div.literal-block-wrapper div.highlight{margin:0}code.descname{background-color:transparent;font-weight:bold;font-size:1.2em}code.descclassname{background-color:transparent}code.xref,a code{background-color:transparent;font-weight:bold}h1 code,h2 code,h3 code,h4 code,h5 code,h6 code{background-color:transparent}.viewcode-link{float:right}.viewcode-back{float:right;font-family:sans-serif}div.viewcode-block:target{margin:-1px -10px;padding:0 10px}img.math{vertical-align:middle}div.body div.math p{text-align:center}span.eqno{float:right}@media print{div.document,div.documentwrapper,div.bodywrapper{margin:0;width:100%}div.sphinxsidebar,div.related,div.footer,#top-link{display:none}}
body{font-family:'goudy old style','minion pro','bell mt',Georgia,'Hiragino Mincho Pro',serif;font-size:17px;background-color:white;color:#000;margin:0;padding:0}div.document{width:940px;margin:30px auto 0 auto}div.documentwrapper{float:left;width:100%}div.bodywrapper{margin:0 0 0 220px}div.sphinxsidebar{width:220px}hr{border:1px solid #b1b4b6}div.body{background-color:#fff;color:#3e4349;padding:0 30px 0 30px}div.body>.section{text-align:left}div.footer{width:940px;margin:20px auto 30px auto;font-size:14px;color:#888;text-align:right}div.footer a{color:#888}div.relations{display:none}div.sphinxsidebar a{color:#444;text-decoration:none;border-bottom:1px dotted #999}div.sphinxsidebar a:hover{border-bottom:1px solid #999}div.sphinxsidebar{font-size:14px;line-height:1.5}div.sphinxsidebarwrapper{padding:18px 10px}div.sphinxsidebarwrapper p.logo{padding:0;margin:-10px 0 0 0;text-align:center}div.sphinxsidebarwrapper h1.logo{margin-top:-10px;text-align:center;margin-bottom:5px;text-align:center}div.sphinxsidebarwrapper h1.logo-name{margin-top:0}div.sphinxsidebarwrapper p.blurb{margin-top:0;font-style:normal}div.sphinxsidebar h3,div.sphinxsidebar h4{font-family:'Garamond','Georgia',serif;color:#444;font-size:24px;font-weight:normal;margin:0 0 5px 0;padding:0}div.sphinxsidebar h4{font-size:20px}div.sphinxsidebar h3 a{color:#444}div.sphinxsidebar p.logo a,div.sphinxsidebar h3 a,div.sphinxsidebar p.logo a:hover,div.sphinxsidebar h3 a:hover{border:0}div.sphinxsidebar p{color:#555;margin:10px 0}div.sphinxsidebar ul{margin:10px 0;padding:0;color:#000}div.sphinxsidebar ul li.toctree-l1>a{font-size:120%}div.sphinxsidebar ul li.toctree-l2>a{font-size:110%}div.sphinxsidebar input{border:1px solid #CCC;font-family:'goudy old style','minion pro','bell mt',Georgia,'Hiragino Mincho Pro',serif;font-size:1em}div.sphinxsidebar hr{border:0;height:1px;color:#AAA;background:#AAA;text-align:left;margin-left:0;width:50%}a{color:#3782be;text-decoration:underline}a:hover{color:#3782be;text-decoration:underline}div.body h1,div.body h2,div.body h3,div.body h4,div.body h5,div.body h6{font-family:'Garamond','Georgia',serif;font-weight:normal;margin:30px 0 10px 0;padding:0}div.body h1{margin-top:0;padding-top:0;font-size:240%}div.body h2{font-size:180%}div.body h3{font-size:150%}div.body h4{font-size:130%}div.body h5{font-size:100%}div.body h6{font-size:100%}a.headerlink{color:#DDD;padding:0 4px;text-decoration:none}a.headerlink:hover{color:#444;background:#eaeaea}div.body p,div.body dd,div.body li{line-height:1.4em}div.admonition{margin:20px 0;padding:10px 30px;background-color:#FCC;border:1px solid #FAA}div.admonition tt.xref,div.admonition a tt{border-bottom:1px solid #fafafa}dd div.admonition{margin-left:-60px;padding-left:60px}div.admonition p.admonition-title{font-family:'Garamond','Georgia',serif;font-weight:normal;font-size:24px;margin:0 0 10px 0;padding:0;line-height:1}div.admonition p.last{margin-bottom:0}div.highlight{background-color:white}dt:target,.highlight{background:#faf3e8}div.note{background-color:#EEE;border:1px solid #CCC}div.seealso{background-color:#EEE;border:1px solid #CCC}div.topic{background-color:#eee}p.admonition-title{display:inline}p.admonition-title:after{content:":"}pre,tt,code{font-family:'Consolas','Menlo','Deja Vu Sans Mono','Bitstream Vera Sans Mono',monospace;font-size:.9em}.hll{background-color:#FFC;margin:0 -12px;padding:0 12px;display:block}tt.descname,tt.descclassname,code.descname,code.descclassname{font-size:.95em}tt.descname,code.descname{padding-right:.08em}img.screenshot{-moz-box-shadow:2px 2px 4px #eee;-webkit-box-shadow:2px 2px 4px #eee;box-shadow:2px 2px 4px #eee}table.docutils{border:1px solid #888;-moz-box-shadow:2px 2px 4px #eee;-webkit-box-shadow:2px 2px 4px #eee;box-shadow:2px 2px 4px #eee}table.docutils td,table.docutils th{border:1px solid #888;padding:.25em .7em}table.field-list,table.footnote{border:0;-moz-box-shadow:none;-webkit-box-shadow:none;box-shadow:none}table.footnote{margin:15px 0;width:100%;border:1px solid #EEE;background:#fdfdfd;font-size:.9em}table.footnote+table.footnote{margin-top:-15px;border-top:0}table.field-list th{padding:0 .8em 0 0}table.field-list td{padding:0}table.field-list p{margin-bottom:.8em}table.footnote td.label{width:0;padding:.3em 0 .3em .5em}table.footnote td{padding:.3em .5em}dl{margin:0;padding:0}dl dd{margin-left:30px}blockquote{margin:0 0 0 30px;padding:0}ul,ol{margin:10px 0 10px 30px;padding:0}pre{background:#EEE;padding:7px 30px;margin:15px 0;line-height:1.3em}dl pre,blockquote pre,li pre{margin-left:0;padding-left:30px}dl dl pre{margin-left:-90px;padding-left:90px}tt,code{background-color:#ecf0f3;color:#222}tt.xref,code.xref,a tt{background-color:#fbfbfb;border-bottom:1px solid white}a.reference{text-decoration:none;border-bottom:1px dotted #3782be}a.reference:hover{border-bottom:1px solid #3782be}a.footnote-reference{text-decoration:none;font-size:.7em;vertical-align:top;border-bottom:1px dotted #3782be}a.footnote-reference:hover{border-bottom:1px solid #3782be}a:hover tt,a:hover code{background:#EEE}@media screen and (max-width:870px){div.sphinxsidebar{display:none}div.document{width:100%}div.documentwrapper{margin-left:0;margin-top:0;margin-right:0;margin-bottom:0}div.bodywrapper{margin-top:0;margin-right:0;margin-bottom:0;margin-left:0}ul{margin-left:0}.document{width:auto}.footer{width:auto}.bodywrapper{margin:0}.footer{width:auto}.github{display:none}}@media screen and (max-width:875px){body{margin:0;padding:20px 30px}div.documentwrapper{float:none;background:white}div.sphinxsidebar{display:block;float:none;width:102.5%;margin:50px -30px -20px -30px;padding:10px 20px;background:#333;color:#FFF}div.sphinxsidebar h3,div.sphinxsidebar h4,div.sphinxsidebar p,div.sphinxsidebar h3 a{color:white}div.sphinxsidebar a{color:#AAA}div.sphinxsidebar p.logo{display:none}div.document{width:100%;margin:0}div.footer{display:none}div.bodywrapper{margin:0}div.body{min-height:0;padding:0}.rtd_doc_footer{display:none}.document{width:auto}.footer{width:auto}.footer{width:auto}.github{display:none}}div#changelog>div.section>ul>li>p:only-child{margin-bottom:0}table.docutils.citation,table.docutils.citation td,table.docutils.citation th{border:0;-moz-box-shadow:none;-webkit-box-shadow:none;box-shadow:none}
pre {
  padding: 1px;
}
  </style>

  <link rel="shortcut icon" href="https://jkawamoto.github.io/ambassadors/favicon.ico" type="image/x-icon"/>

  <meta property="og:type" content="article" />
  <meta property="og:title" content="AmbassadorS" />
  
  <meta name="og:description" content="Yet another Ambassador pattern over SSH." />
  
  <meta property="og:image" content="https://jkawamoto.github.io/ambassadors/img/ambassadors.png" />
  <meta property="og:site_name"  content="AmbassadorS" />

  
  <meta name="twitter:card" content="Yet another Ambassador pattern over SSH." />
  
  <meta name="twitter:site" content="@junkawamoto" />
</head>


	<body role="document">
		<div class="document">
			<div class="documentwrapper">
				<div class="bodywrapper">
					<div class="body" role="main">
						
	
		<h1>Ambassadors</h1>
		

<p><a href="https://github.com/jkawamoto/ambassadors/blob/master/LICENSE">





  
  <amp-img src="https://img.shields.io/badge/license-MIT-blue.svg?style=flat" alt="MIT License" width="78" height="20"
            ></amp-img>
  

</a>
<a href="https://hub.docker.com/r/jkawamoto/ambassadors/">





  
  <amp-img src="https://img.shields.io/badge/dockerhub-jkawamoto%2Fambassadors-blue.svg" alt="Dockerhub" width="216" height="20"
            ></amp-img>
  

</a>
<a href="https://hub.docker.com/r/jkawamoto/rpi-ambassadors/">





  
  <amp-img src="https://img.shields.io/badge/dockerhub-jkawamoto%2Frpi--ambassadors-blue.svg" alt="Dockerhub" width="234" height="20"
            ></amp-img>
  

</a>
<a href="http://microbadger.com/images/jkawamoto/ambassadors">





  
  <amp-img src="https://images.microbadger.com/badges/image/jkawamoto/ambassadors.svg" alt="Image information" width="130" height="20"
            ></amp-img>
  

</a>
<a href="https://github.com/jkawamoto/ambassadors/releases/tag/v1.0.0">





  
  <amp-img src="https://img.shields.io/badge/release-1.0.0-brightgreen.svg" alt="Release" width="88" height="20"
            ></amp-img>
  

</a>
<a href="http://qiita.com/jkawamoto/items/4b87d0f61ab3fbbd2897">





  
  <amp-img src="https://img.shields.io/badge/qiita-%E6%97%A5%E6%9C%AC%E8%AA%9E-brightgreen.svg" alt="Japanese" width="76" height="20"
            ></amp-img>
  

</a></p>

<p>Yet another <a href="https://docs.docker.com/engine/admin/ambassador_pattern_linking/">Ambassador pattern</a> over SSH.</p>







  
  <amp-img src="https://jkawamoto.github.io/ambassadors/img/secure-link.png" alt="Secure link" width="479" height="198"
            layout="responsive"></amp-img>
  



<h2 id="install">Install</h2>

<p>You can pull a built container.</p>

<pre><code class="language-sh">$ docker pull jkawamoto/ambassadors
</code></pre>

<p>If you are running on Raspberry Pi, you can pull it instead.</p>

<pre><code class="language-sh">$ docker pull jkawamoto/rpi-ambassadors
</code></pre>

<h2 id="usage">Usage</h2>

<pre><code class="language-sh">$ docker run -dt jkawamoto/ambassadors (server|client|tunnel) [-v]

Options:
  -v           Verbose mode for debugging.
</code></pre>

<p>AmbassadorS has three modes; server, client, and tunnel.
Those modes are associated as follows.</p>

<pre><code>(a container) ---&gt; (AmbassadorS client) ---&gt; (AmbassadorS tunnel)
              == ssh ==&gt; (AmbassadorS server) ---&gt; (service containers)
</code></pre>

<p>You need one server-mode container on a host which has containers to be linked, i.e. <em>service containers</em>,
and one tunnel-mode container on each &ldquo;client&rdquo; host.
You also need client-mode containers for every linking container.</p>

<h2 id="example">Example</h2>

<p>Suppose you have MySQL and MongoDB containers on host <em>A</em>, and a container on host <em>B</em> wants to link them,
you firstly need to run a server-mode container linking the MySQL and MongoDB containers on host <em>A</em>.</p>

<pre><code class="language-sh">$ docker run -d --name ambassadors_server \
             -v ~/.ssh/:/data/ -p 10022:22 \
             --link mongo:mongo --link mysql:mysql \
             jkawamoto/ambassadors server
</code></pre>

<p>The server-mode container requires <code>authorized_keys</code> in <code>/data/</code> and to expose port <code>22</code> for sshd.
In this example, <code>authorized_keys</code> of host <em>A</em> will be used from the server-mode container.
The server-mode container also needs to link service containers.
In this case, it links to containers named mongo and mysql.</p>

<p>On host <em>B</em>, you need to run a tunnel-mode container.</p>

<pre><code class="language-sh">$ docker run -dt --name ambassadors_tunnel \
            -v ~/.ssh:/root/.ssh -e PORT=10022 -e HOST=&lt;host a&gt; \
            jkawamoto/ambassadors tunnel
</code></pre>

<p>The environment variable <code>HOST</code> is the address for host <em>A</em> and <code>PORT</code> is specified the port number of sshd.
The tunnel-mode container requires a private key of which the related public key <code>id_rsa</code> is included in the <code>authorized_keys</code> put on the server-mode container.
The private key needs to be put in <code>/root/.ssh</code>.
In this example, <code>id_rsa</code> of host <em>B</em> will be used from the tunnel-mode container.</p>

<p>You also need to run client-mode containers for MySQL and MongoDB.</p>

<pre><code class="language-sh">$ docker run -d --name mysql_ambassadors \
             --link ambassadors_tunnel:tunnel --expose 3306 -e PORT=3306 \
             jkawamoto/ambassadors client
$ docker run -d --name mongo_ambassadors \
             --link ambassadors_tunnel:tunnel --expose 27017 -e PORT=27017 \
             jkawamoto/ambassadors client
</code></pre>

<p>Those client-mode containers must link the tunnel-mode container with name <code>tunnel</code> and expose as same port as service containers expose.
In this case, the client-mode container for MySQL exposes <code>3306</code> while the mysql container exposes <code>3306</code>.
Those client-mode containers also need to set environment variable <code>PORT</code> as the exposed port number.</p>

<p>Finally, you can use MySQL and MongoDB running on host <em>A</em> from host <em>B</em>.</p>

<pre><code class="language-sh">$ docker run -d --link mysql_ambassadors:mysql --link mongo_ambassadors:mongo some-app
</code></pre>

<h1 id="license">License</h1>

<p>This software is released under the MIT License, see <a href="LICENSE">LICENSE</a>.</p>

	


            
            <amp-ad layout="responsive" width=300 height=250 type="adsense"
                    data-ad-client="ca-pub-4734862314145555"
                    data-ad-slot="7221708629"></amp-ad>
            
					</div>
				</div>
			</div>

			<div class="sphinxsidebar" role="navigation" aria-label="main navigation">
	<div class="sphinxsidebarwrapper">
		<p class="logo">
			<a href="https://jkawamoto.github.io/ambassadors/">
				<amp-img class="logo" src="https://jkawamoto.github.io/ambassadors/favicon.ico" alt="Logo" width="32" height="32" />
				<h1 class="logo logo-name">AmbassadorS</h1>
			</a>
		</p>

		<p class="blurb">Yet another Ambassador pattern over SSH</p>

		
		

	</div>
</div>
<div class="clearer"></div>
</div>

			<div class="footer">
	&copy; 2017 <a href="https://www.jkawamoto.info/">Junpei Kawamoto</a>
	|
	Powered by <a href="http://gohugo.io/">Hugo 0.30</a>
	&amp; <a href="https://github.com/digitalcraftsman/hugo-alabaster-theme">Alabaster</a>
	
</div>


			

      <amp-analytics type="googleanalytics" id="analytics1">
      <script type="application/json">
      {
        "vars": {
          "account": "UA-82315630-1"
        },
        "triggers": {
          "trackPageview": {
            "on": "visible",
            "request": "pageview"
          }
        }
      }
      </script>
      </amp-analytics>
		</div>

	</body>
</html>
